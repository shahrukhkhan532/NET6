# For auto generating this yaml file for .NET project run these command sequencely
#dotnet new workflow --search
#dotnet new --install TimHeuer.GitHubActions.Templates
#dotnet new workflow

name: Continues Integration and Deployment for Self Runne

on:
  push:
    branches:
      - dummyBranch

env:
  DOTNET_VERSION: "6.0.x"
  AZURE_WEB_APP_NAME: rainers-first-webapp
  TEAM_URL: "https://icaremanagerllc.webhook.office.com/webhookb2/1c9fa85a-a9db-4824-a749-51e475101ae5@89e9d208-fb4a-4579-a02e-ae453b60c3a6/IncomingWebhook/2518c48279da4630b2ad749568c4bf31/22a4babb-2d32-4af5-bb41-4df9d477e8a8"

jobs:
  build_test_deploy:
    runs-on:
      - self-hosted
      - label-test
    steps:

      - name: Development
        run: |
          $s4= ‚Äúfourth string.‚Äù
          $res=[string]::Concat($s1, $s2, $s3, $s4)

          $url='https://api.github.com/users/'+'${{ github.actor }}'
          $content=(curl $url -Method 'GET').Content
          $username=$content | jq -r '.name'
          Write-Output $username
          curl -body '{ "title":"Test", "text":"Deployment done by $username" }' ${{ env.TEAM_URL }} -Method 'POST'

      - name: Check Out Code üöì
        uses: actions/checkout@v3

      - name: Restore Dependencies ‚åö
        shell: cmd
        run: dotnet restore /clp:ErrorsOnly

      - name: Build App üöÄ
        shell: cmd
        run: dotnet build -c Release --no-restore /clp:ErrorsOnly

      - name: Publish App üìë
        shell: cmd
        run: |
          echo ${{ github.actor }}
          dotnet publish -c Release -o ./out /clp:ErrorsOnly

      - name: Deploy to QA Server ‚úî
        shell: cmd
        run: |
          %windir%\system32\inetsrv\appcmd stop apppool gh-actions-iis-demo.com
          xcopy .\out\* "c:\www\gh-actions-iis-demo.com" /i /s /y /Q
          %windir%\system32\inetsrv\appcmd start apppool gh-actions-iis-demo.com
